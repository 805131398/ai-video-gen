# 场景编辑页面 - 超精描述字段回显修复

**日期**: 2026-01-29
**类型**: Bug 修复
**影响范围**: Client 端场景编辑页面

## 问题描述

在场景编辑页面 (`/projects/[id]/script/[scriptId]/scenes/[sceneId]/edit`)，虽然 API 返回的数据中包含 `description` 字段（例如："昏黄的夕阳透过窗户，洒在略显凌乱的餐桌上，父亲躲在客厅阴影处，正急促地往嘴里塞半块点心，眼神中透着不安。"），但在"超精描述"的编辑框（`#description` textarea）中没有显示出来。

## 根本原因

数据结构不匹配问题：

1. **API 返回的数据结构**（`ScriptScene` 类型）：
   ```typescript
   {
     id: string;
     title: string;
     content: {
       description: string;  // description 在 content 对象内
       sceneType: string;
       characters: [...];
       // ...
     }
   }
   ```

2. **BasicInfoCard 组件期望的数据结构**（修复前）：
   ```typescript
   formData: {
     title?: string;
     description?: string;  // 错误：期望在顶层
     duration?: number;
   }
   ```

3. **其他卡片组件的正确实现**：
   - `CameraVisualCard`、`CharacterDialogueCard`、`AudioSettingsCard` 都正确地访问了 `formData.content` 对象
   - 只有 `BasicInfoCard` 错误地尝试从顶层访问 `description`

## 修复方案

修改 `client/src/components/scene-edit/BasicInfoCard.tsx`：

### 1. 更新类型定义
```typescript
// 修复前
interface BasicInfoCardProps {
  formData: {
    title?: string;
    description?: string;  // ❌ 错误
    duration?: number;
  };
  onChange: (field: string, value: any) => void;
}

// 修复后
interface BasicInfoCardProps {
  formData: {
    title?: string;
    duration?: number;
    content?: SceneContent;  // ✅ 正确
  };
  onChange: (field: string, value: any) => void;
}
```

### 2. 添加 content 提取和更新逻辑
```typescript
export default function BasicInfoCard({ formData, onChange }: BasicInfoCardProps) {
  const content = formData.content || {};

  const handleDescriptionChange = (value: string) => {
    onChange('content', {
      ...content,
      description: value,
    });
  };
  // ...
}
```

### 3. 更新 textarea 绑定
```typescript
// 修复前
<textarea
  id="description"
  value={formData.description || ''}  // ❌ 错误
  onChange={(e) => onChange('description', e.target.value)}
  // ...
/>

// 修复后
<textarea
  id="description"
  value={content.description || ''}  // ✅ 正确
  onChange={(e) => handleDescriptionChange(e.target.value)}
  // ...
/>
```

### 4. 更新标签文本
将"场景描述"改为"超精描述"，与用户反馈的字段名称保持一致。

## 修改文件

- `client/src/components/scene-edit/BasicInfoCard.tsx`

## 测试建议

1. 打开任意场景编辑页面
2. 验证"超精描述"字段正确显示 API 返回的 `content.description` 值
3. 修改描述内容并保存
4. 验证保存后的数据结构正确（`description` 应该在 `content` 对象内）
5. 刷新页面，验证修改后的内容能正确回显

## 相关代码位置

- 场景编辑页面: `client/src/pages/SceneEdit.tsx`
- 基本信息卡片: `client/src/components/scene-edit/BasicInfoCard.tsx:59`
- 类型定义: `client/src/types/index.ts:159-168` (ScriptScene)
- API 服务: `client/src/services/script.ts:57-64` (getScene)
