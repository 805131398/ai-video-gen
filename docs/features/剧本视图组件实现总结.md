# 剧本视图组件实现总结

## 任务概述

创建了两个独立的视图组件，用于在剧本编辑页面中以不同方式展示和管理剧本数据。

## 实现内容

### 1. CharacterView 组件
**文件路径**: `client/src/components/project/CharacterView.tsx`

**功能特性**:
- 按角色分组展示场景数据
- 显示每个角色的头像、名称和参与场景数量
- 展示角色在各个场景中的动作和台词
- 支持快速跳转到场景编辑

**Props 接口**:
```typescript
interface CharacterViewProps {
  scenes: ScriptScene[];          // 所有场景数据
  characters: ProjectCharacter[]; // 所有角色数据
  onEditScene: (scene: ScriptScene) => void; // 编辑场景回调
}
```

**核心逻辑**:
- 使用 `flatMap` 遍历所有场景，提取每个角色相关的对话和动作
- 过滤掉没有参与任何场景的角色
- 为每个角色展示详细的场景参与信息

**UI 展示**:
- 角色卡片包含头像、姓名、场景数量
- 场景详情包含标题、时长、动作、台词
- 动作信息：动作描述、情绪、位置（左侧/中间/右侧）
- 台词信息：文本内容、语速、语气

### 2. TimelineView 组件
**文件路径**: `client/src/components/project/TimelineView.tsx`

**功能特性**:
- 可视化时间轴总览
- 彩色编码的场景块展示
- 时间刻度标记（0%、25%、50%、75%、100%）
- 场景详细列表（带序号、时间范围）
- 显示场景统计信息（时长、类型、角色数、台词数）

**Props 接口**:
```typescript
interface TimelineViewProps {
  scenes: ScriptScene[];          // 所有场景数据
  onEditScene: (scene: ScriptScene) => void; // 编辑场景回调
}
```

**核心逻辑**:
- 计算视频总时长（所有场景时长之和）
- 为每个场景计算开始时间和时长百分比
- 使用 HSL 色彩空间自动生成场景块颜色
- 时间格式化函数：`mm:ss`

**UI 展示**:
- 时间轴总览卡片
  - 彩色场景块（可点击）
  - 场景标题和时长
  - 时间刻度标记
  - 悬停效果
- 场景详细列表
  - 序号标签
  - 场景标题
  - 时间范围徽章
  - 场景描述
  - 统计图标（⏱时长、📍类型、👥角色、💬台词）
  - 编辑按钮

## 技术实现细节

### 时间轴可视化
```typescript
// 计算场景宽度百分比
widthPercent: totalDuration > 0
  ? (duration / totalDuration) * 100
  : 100 / scenes.length

// 计算场景位置
left: ${(startTime / totalDuration) * 100}%

// 动态颜色生成（HSL色彩空间）
backgroundColor: `hsl(${(index * 360) / scenes.length}, 70%, 60%)`
```

### 角色场景分组
```typescript
// 使用 flatMap 过滤和提取角色相关数据
const characterDialogues = scenes.flatMap((scene) => {
  const dialogues = scene.content.dialogues?.filter(
    (d) => d.characterId === character.id
  ) || [];
  const actions = scene.content.characters?.filter(
    (c) => c.characterId === character.id
  ) || [];

  // 过滤掉没有参与的场景
  if (dialogues.length === 0 && actions.length === 0) return [];

  return [{ scene, dialogues, actions }];
});
```

### 时间格式化
```typescript
const formatTime = (seconds: number) => {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
};
```

## 组件特点

### 通用性
- 两个组件完全独立，互不依赖
- 使用相同的 `ScriptScene` 类型定义
- 提供统一的 `onEditScene` 回调接口

### 可扩展性
- 支持添加更多视图模式
- 易于集成到剧本编辑页面
- 预留了扩展空间（如添加更多统计信息）

### 用户体验
- **CharacterView**: 角色视角，方便查看单个角色的戏份分布
- **TimelineView**: 时间视角，直观展示视频整体节奏和时间分配
- 交互友好：点击时间轴块或按钮即可编辑场景
- 视觉清晰：使用图标和颜色区分不同信息

## 提交信息

```bash
git add client/src/components/project/CharacterView.tsx client/src/components/project/TimelineView.tsx
git commit -m "feat: create character view and timeline view components"
```

**Commit ID**: `aed9710`

## 后续集成

这两个组件将集成到剧本编辑页面（`ProjectScript.tsx`），与之前创建的 `SceneListView` 一起提供三种不同的视图模式：

1. **场景列表视图** (`SceneListView`): 表格形式，适合批量编辑
2. **角色视图** (`CharacterView`): 按角色分组，查看角色戏份
3. **时间轴视图** (`TimelineView`): 时间线可视化，查看视频节奏

用户可以通过标签页在三种视图之间切换，满足不同的编辑需求。
