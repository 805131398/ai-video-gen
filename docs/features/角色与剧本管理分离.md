# 角色与剧本管理分离

## 更新时间
2026-01-28

## 问题描述

之前的设计中，角色管理和剧本管理混在一起，导致逻辑不清晰：
- 项目管理页面的"查看剧本"按钮跳转到角色管理页面
- 没有独立的剧本管理页面
- 剧本的关联关系不明确

## 解决方案

将角色管理和剧本管理分离为两个独立的页面，明确各自的职责。

### 数据关系

```
Project (项目)
  ├─ ProjectCharacter (角色)
  │   ├─ name, description, avatarUrl
  │   └─ digitalHumans (数字人形象)
  └─ ProjectScript (剧本)
      ├─ characterId (关联角色)
      ├─ title, description
      └─ scenes (场景列表)
```

**关系说明：**
- 一个项目可以有多个角色
- 一个项目可以有多个剧本
- 一个剧本关联一个角色
- 一个角色可以有多个剧本（不同版本）

### 页面结构

#### 1. 角色管理页面 (`/projects/:id`)
**职责：** 管理项目的角色
- 添加、编辑、删除角色
- 生成/更换数字人形象
- 选择角色创建剧本（快捷入口）
- 跳转到剧本管理页面

#### 2. 剧本管理页面 (`/projects/:id/scripts`)
**职责：** 管理项目的所有剧本
- 查看所有剧本列表
- 创建新剧本（选择角色）
- 编辑、删除剧本
- 显示剧本信息（关联角色、场景数、版本等）
- 跳转到角色管理页面

#### 3. 剧本编辑页面 (`/projects/:id/script/:scriptId`)
**职责：** 编辑单个剧本的场景
- 添加、编辑、删除场景
- 场景水平滚动布局
- Tab 切换（场景视图/角色视图/时间轴视图）

## 实现内容

### 1. 新增页面

**ProjectScripts.tsx** - 剧本管理页面
- 显示项目的所有剧本列表（表格形式）
- 创建剧本模态框（选择角色）
- 剧本信息：标题、关联角色、场景数、版本、更新时间
- 操作：编辑、删除
- 导航：返回项目列表、跳转到角色管理

### 2. 路由更新

```typescript
/projects                          // 项目列表
/projects/:id                      // 角色管理
/projects/:id/scripts              // 剧本管理（新增）
/projects/:id/script/:scriptId     // 剧本编辑
```

### 3. 页面间导航

```
项目列表 (ProjectManagement)
  ├─ [角色图标] → 角色管理 (/projects/:id)
  └─ [剧本图标] → 剧本管理 (/projects/:id/scripts)

角色管理 (ProjectDetail)
  ├─ [剧本管理] → 剧本管理 (/projects/:id/scripts)
  └─ [选择角色] → [编辑剧本] → 剧本编辑 (/projects/:id/script/:scriptId)

剧本管理 (ProjectScripts)
  ├─ [角色管理] → 角色管理 (/projects/:id)
  ├─ [创建剧本] → 选择角色 → 剧本编辑 (/projects/:id/script/:scriptId)
  └─ [编辑] → 剧本编辑 (/projects/:id/script/:scriptId)

剧本编辑 (ProjectScript)
  └─ [保存并返回] → 角色管理 (/projects/:id)
```

## 修改文件

### 新增文件
- `client/src/pages/ProjectScripts.tsx` - 剧本管理页面

### 修改文件
- `client/src/App.tsx` - 添加剧本管理路由
- `client/src/pages/ProjectManagement.tsx` - 修复"查看剧本"按钮跳转
- `client/src/pages/ProjectDetail.tsx` - 添加"剧本管理"按钮

## 用户体验提升

### 1. 清晰的职责分离
- **角色管理**：专注于角色的创建和配置
- **剧本管理**：专注于剧本的组织和管理
- **剧本编辑**：专注于场景的编排和内容

### 2. 灵活的导航
- 可以从项目列表直接进入角色管理或剧本管理
- 角色管理和剧本管理之间可以快速切换
- 提供快捷入口（角色管理中可以直接创建剧本）

### 3. 完整的信息展示
- 剧本管理页面显示所有剧本的关键信息
- 一目了然地看到每个剧本的状态
- 方便批量管理和比较

## 使用流程

### 流程 1：从角色管理创建剧本
1. 进入项目 → 角色管理页面
2. 点击"选择角色"按钮
3. 在角色卡片上点击选择
4. 点击"编辑剧本"按钮
5. 自动创建剧本并跳转到剧本编辑页面

### 流程 2：从剧本管理创建剧本
1. 进入项目 → 剧本管理页面
2. 点击"创建剧本"按钮
3. 在模态框中选择角色
4. 点击"创建"按钮
5. 自动创建剧本并跳转到剧本编辑页面

### 流程 3：编辑现有剧本
1. 进入项目 → 剧本管理页面
2. 在列表中找到要编辑的剧本
3. 点击剧本行或"编辑"按钮
4. 跳转到剧本编辑页面

## 后续优化方向

1. **剧本版本管理**：支持同一角色的多个剧本版本
2. **剧本复制**：快速复制现有剧本创建新版本
3. **批量操作**：批量删除、导出剧本
4. **剧本模板**：提供常用剧本模板
5. **协作功能**：多人协作编辑剧本
6. **剧本预览**：在剧本管理页面预览剧本内容
7. **搜索和筛选**：按角色、状态、时间筛选剧本

## 测试要点

1. 从项目列表点击"剧本"图标，验证跳转到剧本管理页面
2. 从角色管理点击"剧本管理"按钮，验证跳转到剧本管理页面
3. 从剧本管理点击"角色管理"按钮，验证跳转到角色管理页面
4. 在剧本管理页面创建剧本，验证选择角色和跳转
5. 在剧本管理页面编辑剧本，验证跳转到剧本编辑页面
6. 在剧本管理页面删除剧本，验证删除功能
7. 验证剧本列表显示正确的信息（角色、场景数、版本等）
8. 验证空状态提示（没有剧本、没有角色）
