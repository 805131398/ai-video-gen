# è§’è‰²ç®¡ç†ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

## ğŸ“š ç»„ä»¶å¯¼å…¥

```typescript
// è§’è‰²å¡ç‰‡ï¼ˆæ”¹è¿›ç‰ˆï¼‰
import CharacterCard from '@/components/project/CharacterCard';

// æ•°å­—äººç”Ÿæˆå™¨
import DigitalHumanGenerator from '@/components/project/DigitalHumanGenerator';

// è§’è‰²è¯¦æƒ…ç¼–è¾‘å™¨ï¼ˆå…¨å±æ¨¡æ€æ¡†ï¼‰
import CharacterDetailEditor from '@/components/project/CharacterDetailEditor';

// åŸæœ‰çš„ç®€å•è¡¨å•ï¼ˆå¯é€‰ä¿ç•™ï¼‰
import CharacterForm from '@/components/project/CharacterForm';
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šè§’è‰²åˆ—è¡¨å±•ç¤º

```typescript
import { useState } from 'react';
import CharacterCard from '@/components/project/CharacterCard';

function CharacterList() {
  const [characters, setCharacters] = useState<ProjectCharacter[]>([]);

  const handleEdit = (character: ProjectCharacter) => {
    // æ‰“å¼€ç¼–è¾‘å™¨
    console.log('ç¼–è¾‘è§’è‰²:', character);
  };

  const handleDelete = async (id: string) => {
    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§’è‰²å—ï¼Ÿ')) return;
    // è°ƒç”¨åˆ é™¤ API
    await deleteCharacter(id);
  };

  const handleGenerateDigitalHuman = (character: ProjectCharacter) => {
    // æ‰“å¼€æ•°å­—äººç”Ÿæˆå™¨
    console.log('ç”Ÿæˆæ•°å­—äºº:', character);
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {characters.map((character) => (
        <CharacterCard
          key={character.id}
          character={character}
          onEdit={handleEdit}
          onDelete={handleDelete}
          onGenerateDigitalHuman={handleGenerateDigitalHuman}
        />
      ))}
    </div>
  );
}
```

### åœºæ™¯2ï¼šåˆ›å»º/ç¼–è¾‘è§’è‰²ï¼ˆå…¨å±ç¼–è¾‘å™¨ï¼‰

```typescript
import { useState } from 'react';
import CharacterDetailEditor from '@/components/project/CharacterDetailEditor';

function ProjectDetail() {
  const [showEditor, setShowEditor] = useState(false);
  const [editingCharacter, setEditingCharacter] = useState<ProjectCharacter>();

  const handleAddCharacter = () => {
    setEditingCharacter(undefined);
    setShowEditor(true);
  };

  const handleEditCharacter = (character: ProjectCharacter) => {
    setEditingCharacter(character);
    setShowEditor(true);
  };

  const handleSubmit = async (data: CreateCharacterRequest) => {
    if (editingCharacter) {
      // æ›´æ–°è§’è‰²
      await updateCharacter(projectId, editingCharacter.id, data);
    } else {
      // åˆ›å»ºè§’è‰²
      await createCharacter(projectId, data);
    }
    setShowEditor(false);
    // åˆ·æ–°åˆ—è¡¨
    await loadCharacters();
  };

  return (
    <div>
      <button onClick={handleAddCharacter}>æ·»åŠ è§’è‰²</button>

      {/* è§’è‰²åˆ—è¡¨ */}
      <CharacterList onEdit={handleEditCharacter} />

      {/* ç¼–è¾‘å™¨æ¨¡æ€æ¡† */}
      {showEditor && (
        <CharacterDetailEditor
          projectId={projectId}
          character={editingCharacter}
          onSubmit={handleSubmit}
          onCancel={() => setShowEditor(false)}
        />
      )}
    </div>
  );
}
```

### åœºæ™¯3ï¼šç‹¬ç«‹ä½¿ç”¨æ•°å­—äººç”Ÿæˆå™¨

```typescript
import { useState } from 'react';
import DigitalHumanGenerator from '@/components/project/DigitalHumanGenerator';

function DigitalHumanPage() {
  const [selectedHumanId, setSelectedHumanId] = useState<string>();

  const handleGenerate = async (
    description: string,
    referenceImage?: string
  ) => {
    // è°ƒç”¨ AI ç”Ÿæˆ API
    const response = await fetch('/api/generate-digital-humans', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ description, referenceImage, count: 4 }),
    });

    const data = await response.json();
    return data.digitalHumans;
  };

  return (
    <div className="max-w-2xl mx-auto p-8">
      <h1 className="text-2xl font-bold mb-6">ç”Ÿæˆæ•°å­—äºº</h1>

      <DigitalHumanGenerator
        characterId="char-123"
        characterName="å¥åº·ä¸“å®¶"
        characterDescription="ä¸€ä½ä¸“ä¸šçš„å¥åº·é¡¾é—®ï¼Œç©¿ç€ç™½å¤§è¤‚ï¼Œæˆ´ç€çœ¼é•œ..."
        referenceImageUrl="https://example.com/reference.jpg"
        selectedHumanId={selectedHumanId}
        onSelect={setSelectedHumanId}
        onGenerate={handleGenerate}
      />
    </div>
  );
}
```

## ğŸ¨ æ ·å¼å®šåˆ¶

### è‡ªå®šä¹‰å¡ç‰‡æ ·å¼

```typescript
<CharacterCard
  character={character}
  onEdit={handleEdit}
  onDelete={handleDelete}
  className="custom-card-class" // æ·»åŠ è‡ªå®šä¹‰ç±»å
/>
```

### è‡ªå®šä¹‰ç¼–è¾‘å™¨æ ·å¼

```typescript
<CharacterDetailEditor
  projectId={projectId}
  character={character}
  onSubmit={handleSubmit}
  onCancel={handleCancel}
  // å¯ä»¥é€šè¿‡ Tailwind çš„ @apply æŒ‡ä»¤è‡ªå®šä¹‰æ ·å¼
/>
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. é¢„åŠ è½½æ•°å­—äººå†å²è®°å½•

```typescript
import { useEffect, useState } from 'react';

function CharacterEditor() {
  const [digitalHumans, setDigitalHumans] = useState<DigitalHuman[]>([]);

  useEffect(() => {
    // é¢„åŠ è½½å†å²è®°å½•
    loadDigitalHumans(characterId).then(setDigitalHumans);
  }, [characterId]);

  return (
    <DigitalHumanGenerator
      // ... å…¶ä»– props
      // å¯ä»¥é€šè¿‡ä¿®æ”¹ç»„ä»¶æ”¯æŒé¢„åŠ è½½çš„å†å²è®°å½•
    />
  );
}
```

### 2. è‡ªå®šä¹‰ç”Ÿæˆé€»è¾‘

```typescript
const handleGenerate = async (description: string, referenceImage?: string) => {
  // 1. æ˜¾ç¤ºåŠ è½½æç¤º
  toast.loading('AI æ­£åœ¨ç”Ÿæˆä¸­...');

  try {
    // 2. è°ƒç”¨ç”Ÿæˆ API
    const response = await generateDigitalHumans({
      description,
      referenceImage,
      count: 6, // è‡ªå®šä¹‰ç”Ÿæˆæ•°é‡
      style: 'realistic', // è‡ªå®šä¹‰é£æ ¼
    });

    // 3. ä¿å­˜åˆ°æ•°æ®åº“
    await saveDigitalHumans(characterId, response.digitalHumans);

    // 4. æ˜¾ç¤ºæˆåŠŸæç¤º
    toast.success(`æˆåŠŸç”Ÿæˆ ${response.digitalHumans.length} ä¸ªæ•°å­—äººï¼`);

    return response.digitalHumans;
  } catch (error) {
    // 5. é”™è¯¯å¤„ç†
    toast.error('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
    throw error;
  }
};
```

### 3. æ‰¹é‡æ“ä½œ

```typescript
function BatchOperations() {
  const [selectedCharacters, setSelectedCharacters] = useState<string[]>([]);

  const handleBatchGenerate = async () => {
    // ä¸ºå¤šä¸ªè§’è‰²æ‰¹é‡ç”Ÿæˆæ•°å­—äºº
    await Promise.all(
      selectedCharacters.map((characterId) =>
        generateDigitalHumansForCharacter(characterId)
      )
    );
  };

  return (
    <div>
      {/* è§’è‰²åˆ—è¡¨ï¼Œæ”¯æŒå¤šé€‰ */}
      <button onClick={handleBatchGenerate}>æ‰¹é‡ç”Ÿæˆæ•°å­—äºº</button>
    </div>
  );
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```typescript
const handleSubmit = async (data: CreateCharacterRequest) => {
  try {
    await onSubmit(data);
    toast.success('ä¿å­˜æˆåŠŸï¼');
  } catch (error) {
    if (error.response?.status === 400) {
      toast.error('è¾“å…¥ä¿¡æ¯æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥');
    } else if (error.response?.status === 413) {
      toast.error('å›¾ç‰‡å¤ªå¤§ï¼Œè¯·å‹ç¼©åä¸Šä¼ ');
    } else {
      toast.error('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  }
};
```

### 2. åŠ è½½çŠ¶æ€

```typescript
function CharacterList() {
  const [loading, setLoading] = useState(true);
  const [characters, setCharacters] = useState<ProjectCharacter[]>([]);

  useEffect(() => {
    loadCharacters()
      .then(setCharacters)
      .finally(() => setLoading(false));
  }, []);

  if (loading) {
    return (
      <div className="grid grid-cols-3 gap-4">
        {Array.from({ length: 6 }).map((_, i) => (
          <div key={i} className="animate-pulse">
            <div className="h-64 bg-gray-200 rounded-lg" />
          </div>
        ))}
      </div>
    );
  }

  return (
    <div className="grid grid-cols-3 gap-4">
      {characters.map((character) => (
        <CharacterCard key={character.id} character={character} {...props} />
      ))}
    </div>
  );
}
```

### 3. è¡¨å•éªŒè¯

```typescript
const handleSubmit = async (data: CreateCharacterRequest) => {
  // å®¢æˆ·ç«¯éªŒè¯
  if (!data.name.trim()) {
    toast.error('è¯·è¾“å…¥è§’è‰²åç§°');
    return;
  }

  if (data.name.length > 50) {
    toast.error('è§’è‰²åç§°ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦');
    return;
  }

  if (!data.description.trim()) {
    toast.error('è¯·è¾“å…¥è§’è‰²æè¿°');
    return;
  }

  if (data.description.length < 20) {
    toast.error('è§’è‰²æè¿°è‡³å°‘éœ€è¦20ä¸ªå­—ç¬¦');
    return;
  }

  // æäº¤
  await onSubmit(data);
};
```

### 4. å›¾ç‰‡ä¼˜åŒ–

```typescript
import imageCompression from 'browser-image-compression';

const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  if (!file) return;

  // å‹ç¼©å›¾ç‰‡
  const compressedFile = await imageCompression(file, {
    maxSizeMB: 1,
    maxWidthOrHeight: 1920,
    useWebWorker: true,
  });

  // ä¸Šä¼ 
  const url = await uploadAvatar(compressedFile);
  setReferenceImageUrl(url);
};
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç¼–è¾‘å™¨æ¨¡æ€æ¡†æ— æ³•å…³é—­ï¼Ÿ

**A**: ç¡®ä¿æ­£ç¡®å¤„ç† `onCancel` å›è°ƒï¼š

```typescript
<CharacterDetailEditor
  onCancel={() => {
    setShowEditor(false);
    setEditingCharacter(undefined);
  }}
/>
```

### Q2: æ•°å­—äººç”Ÿæˆå¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ API é…ç½®å’Œé”™è¯¯æ—¥å¿—ï¼š

```typescript
const handleGenerate = async (description: string) => {
  try {
    const result = await generateDigitalHumans(description);
    return result;
  } catch (error) {
    console.error('ç”Ÿæˆå¤±è´¥:', error);
    // æ£€æŸ¥æ˜¯å¦æ˜¯ API key é—®é¢˜
    if (error.message.includes('API key')) {
      toast.error('AI æœåŠ¡é…ç½®é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
    }
    throw error;
  }
};
```

### Q3: å›¾ç‰‡ä¸Šä¼ æ…¢ï¼Ÿ

**A**: ä½¿ç”¨å›¾ç‰‡å‹ç¼©å’Œè¿›åº¦æç¤ºï¼š

```typescript
const handleUpload = async (file: File) => {
  // 1. å‹ç¼©
  const compressed = await compressImage(file);

  // 2. ä¸Šä¼ ï¼Œæ˜¾ç¤ºè¿›åº¦
  const url = await uploadAvatar(compressed, (progress) => {
    setUploadProgress(progress);
  });

  return url;
};
```

### Q4: å†å²è®°å½•å¤ªå¤šå¯¼è‡´å¡é¡¿ï¼Ÿ

**A**: ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µåŠ è½½ï¼š

```typescript
import { FixedSizeGrid } from 'react-window';

// è™šæ‹Ÿæ»šåŠ¨
<FixedSizeGrid
  columnCount={3}
  columnWidth={120}
  height={300}
  rowCount={Math.ceil(history.length / 3)}
  rowHeight={160}
  width={380}
>
  {/* æ¸²æŸ“é¡¹ */}
</FixedSizeGrid>
```

## ğŸ“š ç›¸å…³èµ„æº

- [ç»„ä»¶ API æ–‡æ¡£](./component-api.md)
- [æ ·å¼æŒ‡å—](./style-guide.md)
- [æ€§èƒ½ä¼˜åŒ–](./performance.md)
- [æµ‹è¯•æŒ‡å—](./testing.md)

---

**æ›´æ–°æ—¥æœŸ**: 2026-01-28
**ç‰ˆæœ¬**: v1.0.0
