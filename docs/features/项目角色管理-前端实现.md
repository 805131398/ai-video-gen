# 项目角色管理 - 前端实现

> 更新时间：2026-01-28
> 状态：✅ 已完成

## 功能概述

在项目详情页面（ProjectDetail）实现了完整的角色管理功能，用户可以：
- 查看项目的所有角色
- 添加新角色
- 编辑现有角色
- 删除角色

## 实现的文件

### 1. 组件

#### CharacterCard.tsx
角色卡片展示组件，显示角色的基本信息：
- 角色名称
- 角色描述
- 角色属性标签
- 编辑和删除按钮

**位置**: `client/src/components/project/CharacterCard.tsx`

#### CharacterForm.tsx
角色表单组件，用于创建和编辑角色：
- 角色名称输入（必填）
- 角色描述输入（必填）
- 角色属性管理（可选）
  - 支持添加多个键值对属性
  - 支持删除属性
- 表单验证
- 提交和取消按钮

**位置**: `client/src/components/project/CharacterForm.tsx`

### 2. 页面

#### ProjectDetail.tsx
项目详情页面，集成了角色管理功能：

**功能特性**：
- 显示项目基本信息（主题、标题）
- 角色列表展示（网格布局）
- 添加角色按钮
- 表单显示/隐藏控制
- 空状态提示
- 错误提示
- 加载状态

**交互流程**：
1. 用户点击"添加角色"按钮
2. 显示角色表单
3. 填写角色信息并提交
4. 自动刷新角色列表
5. 隐藏表单

**编辑流程**：
1. 用户点击角色卡片的编辑按钮
2. 显示预填充的角色表单
3. 修改信息并提交
4. 自动刷新角色列表
5. 隐藏表单

**删除流程**：
1. 用户点击角色卡片的删除按钮
2. 显示确认对话框
3. 确认后删除角色
4. 自动刷新角色列表

**位置**: `client/src/pages/ProjectDetail.tsx`

### 3. 服务层

#### project.ts
项目相关的 API 调用服务：

```typescript
// 角色管理相关函数
getProjectCharacters(projectId: string)
createCharacter(projectId: string, data: CreateCharacterRequest)
updateCharacter(projectId: string, characterId: string, data: Partial<CreateCharacterRequest>)
deleteCharacter(projectId: string, characterId: string)
```

**位置**: `client/src/services/project.ts`

## API 接口

所有接口已在后端实现，位于 `web/src/app/api/projects/[id]/characters/`

### 获取角色列表
```http
GET /api/projects/{projectId}/characters
```

### 创建角色
```http
POST /api/projects/{projectId}/characters
Content-Type: application/json

{
  "name": "角色名称",
  "description": "角色描述",
  "attributes": {
    "age": "中年",
    "gender": "女"
  },
  "sortOrder": 0
}
```

### 更新角色
```http
PUT /api/projects/{projectId}/characters/{characterId}
Content-Type: application/json

{
  "name": "更新后的名称",
  "description": "更新后的描述"
}
```

### 删除角色
```http
DELETE /api/projects/{projectId}/characters/{characterId}
```

## 路由配置

项目详情页面路由：`/projects/:id`

在 `App.tsx` 中已配置：
```tsx
<Route path="projects/:id" element={<ProjectDetail />} />
```

## UI 设计

### 布局
- 最大宽度：6xl (1280px)
- 响应式网格：
  - 移动端：1 列
  - 平板：2 列
  - 桌面：3 列

### 颜色方案
- 主色调：蓝色 (blue-500, blue-600)
- 成功：绿色
- 错误：红色
- 中性：灰色系列

### 交互反馈
- 按钮悬停效果
- 加载状态提示
- 错误消息显示
- 空状态提示
- 删除确认对话框

## 使用示例

### 访问项目详情页
```
/projects/{projectId}
```

### 添加角色
1. 点击"添加角色"按钮
2. 填写表单：
   - 角色名称：健康专家
   - 角色描述：40岁左右的女性医生，温和亲切，穿白大褂，戴眼镜
   - 属性：
     - age: 中年
     - gender: 女
     - profession: 医生
3. 点击"保存角色"

### 编辑角色
1. 点击角色卡片上的编辑图标
2. 修改信息
3. 点击"保存角色"

### 删除角色
1. 点击角色卡片上的删除图标
2. 确认删除

## 注意事项

1. **权限验证**：所有 API 请求都需要用户认证
2. **项目所有权**：只能管理自己创建的项目的角色
3. **必填字段**：角色名称和描述为必填项
4. **属性格式**：属性以键值对形式存储，支持任意 JSON 格式
5. **排序**：角色按 sortOrder 和创建时间排序

## 后续优化建议

1. **拖拽排序**：支持拖拽调整角色顺序
2. **角色模板**：提供常用角色模板快速创建
3. **批量操作**：支持批量删除角色
4. **角色预览**：添加角色头像上传和预览功能
5. **AI 生成**：集成 AI 自动生成角色描述
6. **角色复制**：支持复制角色到其他项目

## 相关文档

- [项目主题与角色管理功能](./project-theme-and-characters.md) - 完整的功能设计文档
