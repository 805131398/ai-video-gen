# 路由参数统一修复

## 问题描述

启动开发服务器时出现 Next.js 路由冲突错误：

```
Error: You cannot use different slug names for the same dynamic path ('projectId' !== 'id').
```

## 问题原因

在 `web/src/app/(main)/projects/` 目录下同时存在两个冲突的动态路由目录：

1. `[id]` - 用于脚本相关页面
2. `[projectId]` - 用于其他工作流步骤页面（topic, title, attributes, copy, images, videos, voice, compose）

Next.js 不允许在同一层级使用不同的动态参数名称，因为这会导致路由解析歧义。

## 解决方案

### 1. 目录结构调整

- 将 `[id]/scripts` 目录移动到 `[projectId]` 下
- 删除空的 `[id]` 目录
- 将 `[projectId]` 重命名为 `[id]`

最终目录结构：
```
web/src/app/(main)/projects/[id]/
├── attributes/
├── compose/
├── copy/
├── images/
├── scripts/
│   ├── [scriptId]/
│   │   └── edit/
│   ├── new/
│   └── page.tsx
├── title/
├── topic/
├── videos/
├── voice/
├── layout.tsx
└── page.tsx
```

### 2. 代码修改

批量替换所有文件中的参数引用：

1. **路由参数提取**
   ```typescript
   // 修改前
   const projectId = params.projectId as string;

   // 修改后
   const id = params.id as string;
   ```

2. **Hook 调用**
   ```typescript
   // 修改前
   const { project, mutate } = useProject(projectId);

   // 修改后
   const { project, mutate } = useProject(id);
   ```

3. **API 调用**
   ```typescript
   // 修改前
   await fetch(`/api/projects/${projectId}/steps/topic/generate`, {...})

   // 修改后
   await fetch(`/api/projects/${id}/steps/topic/generate`, {...})
   ```

4. **路由跳转**
   ```typescript
   // 修改前
   router.push(`/projects/${projectId}/title`)

   // 修改后
   router.push(`/projects/${id}/title`)
   ```

5. **依赖数组**
   ```typescript
   // 修改前
   }, [project, isLoading, projectId, router]);

   // 修改后
   }, [project, isLoading, id, router]);
   ```

### 3. 受影响的文件

- `web/src/app/(main)/projects/[id]/layout.tsx`
- `web/src/app/(main)/projects/[id]/page.tsx`
- `web/src/app/(main)/projects/[id]/topic/page.tsx`
- `web/src/app/(main)/projects/[id]/title/page.tsx`
- `web/src/app/(main)/projects/[id]/attributes/page.tsx`
- `web/src/app/(main)/projects/[id]/copy/page.tsx`
- `web/src/app/(main)/projects/[id]/images/page.tsx`
- `web/src/app/(main)/projects/[id]/videos/page.tsx`
- `web/src/app/(main)/projects/[id]/voice/page.tsx`
- `web/src/app/(main)/projects/[id]/compose/page.tsx`
- `web/src/app/(main)/projects/[id]/scripts/page.tsx`
- `web/src/app/(main)/projects/[id]/scripts/new/page.tsx`

## 验证

修复后，路由冲突错误消失，开发服务器可以正常启动。

## 注意事项

1. **函数参数名不受影响**：组件和 hooks 中的函数参数名（如 `useProject(projectId: string)`）可以保持不变，只需要统一路由参数名。

2. **API 路由不受影响**：`web/src/app/api/projects/[id]/` 下的 API 路由已经使用 `[id]`，无需修改。

3. **向后兼容性**：此修改会影响所有使用项目路由的链接，但由于是在开发阶段修复，不涉及生产环境的向后兼容问题。

## 提交信息

```
fix: unify dynamic route parameter from [projectId] to [id]

解决 Next.js 路由冲突错误：
- 将 web/src/app/(main)/projects/[projectId] 重命名为 [id]
- 合并 [id]/scripts 目录到统一的 [id] 目录下
- 更新所有页面组件中的参数引用（params.projectId -> params.id）
- 更新所有 API 调用和路由跳转中的变量名

修复错误：
Error: You cannot use different slug names for the same dynamic path ('projectId' !== 'id')
```
